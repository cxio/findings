syntax = "proto3";

// Proto 通用数据包
// 用于封装其它proto编码数据，但同时提供类型标识。
message Proto {
    int32 name = 1; // 指令名
    bytes data = 2; // 关联数据（待解码）
}

// Kind 节点声明类别
// 如果节点仅需NAT探测而无需打洞服务，name可以任意设置，但base需合法。
// 因为NAT探测是标准服务，无需类型区分。
// base:
// - depots     数据驿站类型
// - blockchain 区块链节点类型
// - app        应用节点类型
// - findings   发现节点类型
// seek:
// 客户端向服务器寻求的服务。
// - find:net   参与组网（仅适用 findings，UDP）
// - find:help  寻求上线协助（获取 Findings 公网节点，适用 UDP & TCP）
// - app:kinds  获取服务器支持的应用名清单（UDP & TCP）
// - app:serv   获取服务器暂存的TCP应用服务节点（TCP）
// - nat:cone   请求NAT类型探测服务（UDP）
// - nat:live   请求NAT映射存活期探测服务（UDP）
// - app:punch  请求UDP打洞协助&信令协调（UDP）
// - peer:tcp   登记为可直连的TCP服务器（对应 app:serv 目标）
message Kind {
    string base = 1;    // 基础名称（depots|blockchain|app|findings）
    string name = 2;    // 具体的应用名称（……）
    string seek = 3;    // 寻求的服务（find:net|find:help|app:kinds|app:serv|...）
}

// Stake 服务器收益账户
// 公共服务节点向应用节点提供的信息，以获取可能有的奖励/捐赠。
message Stake {
    string addr = 1;    // 收益地址（区块链）
    string member = 2;  // 服务节点标识（群成员，通常也为区块链地址）
}

// NodeInfo 节点信息
// 每一个节点都应有的信息，表达自身所属应用的类型。
// type:
// 对应 Kind 中的 base 和 name，中间以冒号（:）分隔。
// spki:
// 用于节点间通过自签名证书创建安全连接（SPKI指纹验证）。
// natt:
// - 0: Blocked     UDP 阻塞
// - 1: Pub/FullC   公网或FullC
// - 2: RC          受限
// - 3: P-RC        端口受限
// - 4: Firewalled  UDP 防火墙（可主动打洞）
// - 5: Sym         对称（不可打洞）
message NodeInfo {
    string type = 1;    // 节点类型：depots:x | blockchain:x | app:x | findings:x
    string network = 2; // 网络类型：tcp | udp
    bytes ip = 3;       // IP地址（IPv4/IPv6，公网）
    int32 port = 4;     // 端口号（NAT 公网映射）
    int32 natt = 6;     // NAT类型：Pub/FullC | RC | ...
    bytes spki = 7;     // 证书的公钥编码哈希（SPKI指纹）
}

option go_package = "../base";
