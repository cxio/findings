# 节点发现服务（findings）

## 前言

提供各种类型节点的登记注册，维护一个节点连系信息的暂存池，向请求目标类型节点信息的用户提供连系清单。同时，作为P2P网络的基础设施，为新节点的加入提供 `NAT打洞` 服务支持，因为findings已经是一个网络，所以可以多机协作而无需双IP配置。

一台服务器维护的节点信息包含同类节点（`findings`）、数据驿站的 `depots/archives` 和 `depots/blockqs` 公共服务节点，以及不同区块链的工作节点。

通常，应用节点会启动一个自己的findings服务器，该服务器通过多种方式搜寻其它findings服务节点进行组网。如果存在已知的公共findings节点，组网会很快，否则可能是一个比较耗时的过程。如果需要服务器实时可用，运行一个自己的长期在线的findings是一个不错的选择。

除了对 `depots/archives, blockqs` 公共服务节点会普遍支持外，对于不同的区块链应用，findings服务器会有自己的选择。服务器通常会先声明自己支持的区块链的名称，并向请求节点信息的区块链应用传递一个相同链的地址，用于接收可能有的奖励。



## 用法

（略）



## 性能

（略）



## 附：网络的连通性

### 暴力发现

传统的P2P网络有一个致命的缺陷：起始中枢。即新节点刚上线时需要获得其它节点的信息以建立初次连接，这时就需要一个提供这些信息的中心服务器。而一旦这样的服务器被禁用，P2P的逻辑就执行不起来。

目前解决这个问题的办法有几个，比如在App发布时就加入几个主要节点的IP，或者通过专用的渠道获取。但实际上这些都可以被封堵。

findings是一个网络，通过大众化的利益驱动模式运行且成本低廉。如果网络已经启动运行，假以时日，数以万计的服务器规模是可预期的。如果无需顾及时间，用IP遍历的 **暴力发现** 方式去发现这个已经运行的网络，则不应该是一件太困难的事。findings服务器可以仅仅只是一台旧手机或树莓派，可以长期挂机，因此这个P2P网络就会很大。

用户用一台小设备挂机扫描，暴力发现findings网络，一旦成功，用户就无需担心自己的具体类P2P网络找不到了。

App发布时会默认配置几个IP，这些IP至少曾经有效，用户也可以修改这个配置。作为一种暴力发现优化，这些IP会作为随机IP的衍生起点，新创建的IP会围绕着它。这是基于友好用户可能成群结队的假设。同时，这也可用于IP簇优化：配置一个簇中间的一个IP号，然后随机衍生的IP就会在它附近。


### 标准端口混入

如果管理者屏蔽了Findings服务的默认端口号，我们可以采用通用服务端口混入的方式，比如 https 的标准端口 443。因为大多数的公网IP都不会提供这种标准服务，所以在这个端口提供 findings 服务也是可行的。

这需要公网IP主机们的共同努力，来应对这种网络封锁。


### 工作量之下的动态端口

网络阻断可能针对特定的端口，对抗这种封锁的一个方法是采用**动态端口**。这要求这种动态是可预测的，预测算法可以加入工作量的逻辑，迫使攻击者也需要付出同样的代价。

普通用户的开销是可以接受的（甚至不易觉察），但对攻击者而言，阻断大量的目标服务器就需要大量的工作量运算。

毫无疑问，这是最后的可能方式，这里仅提供思路参考。
